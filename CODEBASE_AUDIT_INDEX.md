# Codebase Audit Index - MindFork App

**Date:** 2025-11-02
**Purpose:** Complete audit documentation for systematic code review and bug fixing
**Generated by:** Claude Code - Codebase Inventory Tool

---

## Three-Document Audit System

This audit has been organized into three comprehensive documents designed for systematic review:

### 1. CODEBASE_INVENTORY.md (31 KB, 679 lines)
**Complete file-by-file component and service mapping**

Purpose: Understand the structure and dependencies of every file in the codebase.

Contents:
- All 25+ screen components with purposes and dependencies
- All 60+ reusable components organized by feature
- All 45+ service files with key methods
- 12+ custom hooks
- 6 API service files
- Type definitions
- UI components
- Database tables overview

Use this document to:
- Find where specific features are implemented
- Understand component dependencies
- Map out data flow
- Identify what each file does

**Start Here:** If you want to know what every file does and how they connect.

---

### 2. AUDIT_NOTES.md (15 KB, 478 lines)
**Detailed issues, bugs, TypeScript errors, and recommendations**

Purpose: Identify specific problems and code quality issues that need fixing.

Contents:
- Critical issues found (TypeScript @ts-ignore)
- Screen component issues (Alert usage, console.logs, etc.)
- Component issues (deprecation warnings, type safety)
- Service file concerns (HIPAA compliance, security)
- API service TypeScript problems
- Hook issues (infinite loops, memory leaks)
- Context type safety issues
- Utility problems
- Navigation issues
- Database issues
- Performance concerns
- Action items checklist (HIGH/MEDIUM/LOW priority)

Use this document to:
- Find bugs and potential issues
- Understand severity levels
- Get specific recommendations
- Plan fixes systematically

**Start Here:** If you want to know what bugs exist and how to fix them.

---

### 3. INVENTORY_SUMMARY.md (12 KB, 488 lines)
**High-level overview, features, tech stack, and quick reference**

Purpose: Quick reference guide for architecture and features.

Contents:
- Code organization statistics
- Key features inventory (9 major feature areas)
- Technology stack details
- Database architecture
- Critical data flows
- Security considerations
- Performance considerations
- Testing infrastructure
- Known limitations
- Development notes
- Audit priority matrix
- Files for systematic audit
- Quick reference (most complex components, services, hooks)

Use this document to:
- Understand the architecture
- See all features at a glance
- Find priority areas to audit first
- Understand data flows
- Learn the tech stack

**Start Here:** If you want a high-level overview before diving deep.

---

## How to Use This Audit

### Quick Start (15 minutes)
1. Read INVENTORY_SUMMARY.md "Quick Statistics" section
2. Skim AUDIT_NOTES.md "Action Items Summary"
3. Check the "Files for Systematic Audit" section

### Thorough Code Review (2-3 hours)
1. Read INVENTORY_SUMMARY.md completely
2. Review CODEBASE_INVENTORY.md to understand structure
3. Read through AUDIT_NOTES.md carefully
4. Open flagged files and review the specific line numbers

### Targeted Bug Fix (30-60 minutes each issue)
1. Find issue in AUDIT_NOTES.md with its severity level
2. Get file path and line numbers
3. Go to CODEBASE_INVENTORY.md to understand dependencies
4. Open file and fix the issue

---

## Critical Issues to Address

### HIGH Priority (Fix First)
Located in AUDIT_NOTES.md:

1. **Alert.alert() Usage** (DevToolsScreen.tsx, SignInScreen.tsx, OnboardingScreen.tsx)
   - Lines: Various
   - Fix: Replace with custom modals
   - Time: 1-2 hours

2. **Camera Deprecation** (PhotoCaptureModal.tsx, PhotoOptionsModal.tsx)
   - Issue: Using deprecated Camera import
   - Fix: Use CameraView, inline styles
   - Time: 30 minutes

3. **HIPAA Compliance** (AIFoodScanService.ts)
   - Issue: Image data handling not verified for compliance
   - Fix: Review and document HIPAA compliance
   - Time: 1-2 hours

4. **Secure Storage Verification** (secureStorage.ts)
   - Issue: Needs verification that sensitive data uses SecureStore
   - Fix: Audit all sensitive data storage
   - Time: 1-2 hours

5. **useAgentStream Cleanup** (useAgentStream.ts)
   - Issue: Potential memory leaks with streaming
   - Fix: Add proper cleanup and abort signals
   - Time: 1-2 hours

### MEDIUM Priority (Important)
1. Remove all console.log/console.error (5+ locations)
2. Fix TypeScript type assertions (as Record<string, any>)
3. Add error boundaries to data-fetching screens
4. Verify goalCalculations.ts edge cases
5. Check Zustand infinite loop patterns

### LOW Priority (Nice to have)
1. Performance optimizations
2. String literal apostrophe rule compliance
3. RLS policy documentation
4. Additional test coverage

---

## File Organization Quick Reference

### Most Critical Files to Audit
```
1. /home/user/workspace/src/contexts/AuthContext.tsx - Session management
2. /home/user/workspace/src/services/AIFoodScanService.ts - HIPAA concerns
3. /home/user/workspace/src/screens/DevToolsScreen.tsx - Alert usage
4. /home/user/workspace/src/hooks/useAgentStream.ts - Memory leaks
5. /home/user/workspace/src/lib/supabase.ts - TypeScript issues
```

### Feature Area Audit Paths
- **Food:** `src/services/FoodService.ts`, `src/components/food/*`
- **Coach:** `src/screens/coach/CoachScreen.tsx`, `src/services/CoachContextService.ts`
- **Health:** `src/screens/fasting/`, `src/screens/dashboard/`
- **Subscriptions:** `src/screens/subscription/`, `src/components/subscription/`
- **Utils:** `src/utils/` (error-handling, secureStorage, logger)

---

## Statistics & Summary

### Codebase Size
- **160+** TypeScript/TSX files
- **31 KB** inventory documentation
- **15 KB** detailed audit notes
- **43+ KB** total documentation

### High-Risk Areas (Per Audit)
- 3 files with Alert.alert() issues
- 2 files with camera deprecation
- 5 files with console.log issues
- 1 file with @ts-ignore suppressions
- Unknown number of TypeScript type issues

### Feature Maturity
- Core auth: Production ready
- Food tracking: Mature with concerns
- Coach system: Advanced with audio/video
- Health tracking: Implemented
- Subscriptions: Implemented
- Testing: Comprehensive AI testing framework

---

## Database Tables by Risk Level

### Critical (User Data)
- profiles
- food_entries
- weight_logs
- coach_conversations

### Important (Functionality)
- fasting_logs
- meal_plans
- goals
- achievements

### Support (Features)
- subscriptions
- invoices
- payment_methods
- coaches

---

## Dependencies to Verify

### Potentially Outdated
- @supabase/supabase-js (has @ts-ignore)
- expo-camera (deprecated Camera import)

### API Integrations
- OpenAI (working)
- Anthropic (working)
- Grok (working)
- USDA (food database)
- ElevenLabs (text-to-speech)

---

## Testing Infrastructure

**Location:** DevToolsScreen.tsx

Available tests:
- CoachTestingService - Coach quality (30-60 seconds)
- FoodAnalyzerTestingService - Food accuracy (30-60 seconds)
- ContinuousImprovementService - Full suite (1-2 minutes)

Prerequisites:
- Run: `database/migrations/ai_testing_schema.sql`
- Set: Test user with proper permissions

---

## Environment Verification Checklist

Before deploying fixes:

- [ ] EXPO_PUBLIC_SUPABASE_URL is set
- [ ] EXPO_PUBLIC_SUPABASE_ANON_KEY is set (public key)
- [ ] OpenAI API key in .env (not committed)
- [ ] Anthropic API key in .env (not committed)
- [ ] No API keys in console.logs
- [ ] No sensitive data logged
- [ ] HIPAA compliance verified
- [ ] Privacy policy compliance verified
- [ ] RLS policies documented

---

## Next Steps

1. **Review** this index (5 minutes)
2. **Choose** your audit starting point:
   - For overview: Read INVENTORY_SUMMARY.md
   - For bugs: Read AUDIT_NOTES.md
   - For details: Read CODEBASE_INVENTORY.md
3. **Use** line numbers and file paths provided
4. **Reference** CODEBASE_INVENTORY.md when you need context
5. **Cross-reference** dependencies between files

---

## Related Documentation

Other documents in /home/user/workspace/:
- CLAUDE.md - Project specifications and rules
- README.md - Project overview
- TECHNICAL_SPECIFICATIONS.md - Technical deep-dive

---

## Contact & Questions

For questions about:
- **Component purposes:** See CODEBASE_INVENTORY.md
- **Specific bugs:** See AUDIT_NOTES.md with file/line references
- **Architecture:** See INVENTORY_SUMMARY.md
- **Code standards:** See CLAUDE.md

---

**Audit Generated:** 2025-11-02
**Total Documentation:** ~43 KB
**Estimated Review Time:** 2-3 hours
**Estimated Fix Time:** 8-12 hours for HIGH priority items

---

**End of Audit Index**

Quick Start: Open INVENTORY_SUMMARY.md next.
